<div class="container-fluid pt-bg">
  <form (ngSubmit)="saveLabRequest(labRequest)" [formGroup]="labRequest" class="margin-bottom">
    <div class="row">
      <div class="col-md-12 bg-light">
        <span class="txt-position"> <h3 style="color: #7f7f7f">Add Lab Requests</h3></span>
        <button type="button" class="btn btn-success fl-bg" style="text-decoration: none; color: white;"
                data-toggle="modal" data-target="#exampleModalScrollable" (click)="getLabRequests()" >View Lab Request</button>
      </div>
      </div>


    <div class="row">
      <div class="col-md-12">
        <div class="form-group">
          <label  class="text-color">Patient*</label>
          <ng-select dropdownPosition="auto" [selectOnTab]="true" placeholder="Select patient" virtualScroll="true"
                     formControlName="patient" >
            <ng-option *ngFor="let patient of patients" [value]="patient.id"  >
              {{patient.patientMiddleName}} {{patient.patientFirstName}}  {{patient.patientLastName}}
            </ng-option>
          </ng-select>
        </div>
        <div class="error alert-warning" *ngIf="labRequest.get('patient').hasError('required') && labRequest.get('patient').touched">
          Patient Name should be recorded!
        </div>
        </div>
      </div>
    <div class="row">
      <div class="col-md-12">
        <label for="testName" class="text-color">Test Name*</label>
        <input type="text" class="form-control" formControlName="testName" placeholder="Enter test name" id="testName">
      </div>
      <div class="error alert-warning" *ngIf="labRequest.get('testName').hasError('required') && labRequest.get('testName').touched">
         Test name details should be recorded!
      </div>
      <div class="error alert-warning" *ngIf="labRequest.get('testName').hasError('minlength') && labRequest.get('testName').touched">
        Minimum of 5 characters
      </div>
    </div>
    <div class="row" style="margin-top: 5px;">
      <div class="col-md-6">

          <label for="doctorName" class="text-color">Doctor*</label>
          <input type="text" [disabled]="true"  class="form-control" placeholder="{{staffName}}" id="doctorName">

      </div>
      <div class="col-md-6">
        <label class="text-color">Test Date</label>
        <div>
          <h6><span>{{testRequestDate | date : 'fullDate'}}</span></h6>
        </div>
      </div>
    </div>

    <div class="row button-margin" style="padding-top: 10px;">
      <div class="col-md-2"></div>
      <div class="col-md-4">
        <button  type="submit" [disabled]="labRequest.invalid" class="btn btn-lg btn-block btn-color text-white btn-hover">Submit</button>
      </div>
      <div class="col-md-4">
        <button  [routerLink]="['/main-dashboard/main-treatment/treatment']" class="btn btn-lg btn-block btn-color text-white btn-hover">Cancel</button>
      </div>
      <div class="col-md-2"></div>
    </div>
  </form>

  <div  class="modal fade" id="exampleModalScrollable" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalScrollableTitle">Lab Requests</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div  class="modal-body" >
          <div *ngIf="message" class="bg-success">
            <h5 >{{message}}</h5>
          </div>
          <table id="dtMaterialDesignExample" class="table table-responsive-lg  table-margin table-striped" cellspacing="0" width="100%">
            <thead class="thead-light">
            <tr>
              <th class="th-sm">Patient Name</th>
              <th class="th-sm">Test Name</th>
              <th class="th-sm">Date of Request</th>
              <th class="th-sm">Doctor</th>
              <th class="th-sm"></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let labData of getLabData">
              <td *ngFor="let patient of labData.patient">
                 {{patient.patientFirstName}} {{patient.patientLastName}}
              </td>
              <td>{{labData.testName}}</td>
              <td>{{labData.dateOfRequest | date: 'fullDate'}}</td>
              <td>{{labData.doctorName}}</td>
              <td><button class="btn btn-danger" (click)="deleteLabRequest(labData.id)">Delete Request</button></td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <!--          <button type="button" class="btn btn-primary">Save changes</button>-->
        </div>
      </div>
    </div>
  </div>
</div>
